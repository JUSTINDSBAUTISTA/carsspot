<h1>Cars</h1>
<p><%= pluralize(@cars.count, 'car') %> found</p>

<div class="filter-container" data-controller="date-picker car dropdown modal places-autocomplete">
  <%= form_with url: cars_path, method: :get, local: true do |form| %>
    <div class="filter-row">
      <div data-controller="places-autocomplete" style="position: relative;">
        <form id="search-form" data-action="submit->places-autocomplete#search">
          <input type="text" class="search-input location-input pac-target-input" placeholder="Specific address, station, subway station..." id="searchAddress" name="location" data-places-autocomplete-target="indexInput" value="<%= params[:location] %>" autocomplete="off">
        </form>
      </div>

      <div class="datetimepicker">
        <input type="date" id="pickupDate" name="pickup_date" value="<%= params[:pickup_date] %>" data-date-picker-target="startDate">
        <span></span>
        <input type="time" id="pickupTime" name="pickup_time" value="<%= params[:pickup_time] %>" data-date-picker-target="startTime">
      </div>

      <div class="datetimepicker">
        <input type="date" id="returnDate" name="return_date" value="<%= params[:return_date] %>" data-date-picker-target="endDate">
        <span></span>
        <input type="time" id="returnTime" name="return_time" value="<%= params[:return_time] %>" data-date-picker-target="endTime">
      </div>

      <%= button_tag "Search", class: "search-button1" %>

      <div data-controller="dropdown">
        <button type="button" class="filter-button dropdown-toggle" data-action="click->dropdown#toggleDropdown" aria-haspopup="true" aria-expanded="false">Vehicle type</button>
        <div class="dropdown-menu" data-dropdown-target="dropdown">
          <h3>VEHICLE TYPE</h3>
          <div class="vehicle-types">
            <% @car_types.each do |type| %>
              <button type="button" class="vehicle-type" data-type="<%= type %>" data-action="click->dropdown#selectType click->modal#toggleButton" data-dropdown-target="vehicleTypeButton" aria-pressed="false">
                <i class="fas fa-car"></i> <%= type %>
              </button>
            <% end %>
          </div>
          <div class="dropdown-actions">
            <button type="button" class="reset-button" data-action="click->dropdown#resetFilters">Reset</button>
            <button type="button" class="apply-button" data-action="click->dropdown#applyTypes">Apply</button>
          </div>
        </div>
      </div>

      <button type="button" class="filter-button" data-action="click->modal#toggleModal">More filters</button>
    </div>

    <div id="filters-modal" class="modal" data-modal-target="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Filters</h2>
          <button type="button" class="close" data-action="click->modal#closeModal">&times;</button>
        </div>
        <div class="modal-body">
          <h3>Instant Booking</h3>
          <div class="checkbox-wrapper-9">
            <%= form.check_box :instant_booking, class: "tgl tgl-flat", id: "cb-instant-booking", name: "instant_booking" %>
            <label class="tgl-btn" for="cb-instant-booking"></label>
          </div>
          <hr>
          <h3>Number of Places</h3>
          <div>
            <label for="number-of-places">Minimum number of places.</label>
            <div class="quantity">
              <button type="button" class="minus" aria-label="Decrease">&minus;</button>
              <%= form.number_field :number_of_places, value: 2, min: 1, class: "input-box", id: "number-of-places", name: "number_of_places" %>
              <button type="button" class="plus" aria-label="Increase">&plus;</button>
            </div>
          </div>
          <hr>
          <h3>Recent Cars Only</h3>
          <div class="checkbox-wrapper-9">
            <%= form.check_box :recent_cars, class: "tgl tgl-flat", id: "cb-recent-cars", name: "recent_cars" %>
            <label class="tgl-btn" for="cb-recent-cars"></label>
          </div>
          <hr>
          <h3>Features</h3>
          <div class="features-grid">
            <% features_icons = {
              'Air Conditioning' => 'fa-snowflake',
              'Cruise Control' => 'fa-tachometer-alt',
              'GPS' => 'fa-map-marker-alt',
              'Baby Seat' => 'fa-child',
              'Roof Box' => 'fa-car-top',
              'Bike Rack' => 'fa-bicycle',
              'Winter Tires' => 'fa-snowflake',
              'Snow Chains' => 'fa-snowflake',
              'Ski Racks' => 'fa-skiing',
              'Audio / iPod Input' => 'fa-music',
              'Bluetooth Audio' => 'fa-bluetooth',
              'Hitch' => 'fa-trailer',
              'Wheelchair Accessible' => 'fa-wheelchair',
              'Apple CarPlay' => 'fa-car',
              'Android Auto' => 'fa-android',
              'Dashcam' => 'fa-video',
              'Four-wheel Drive' => 'fa-car'
            } %>
            <% features_icons.each do |feature, icon| %>
              <button type="button" class="feature-item" data-action="click->modal#toggleButton" aria-pressed="false">
                <i class="fas <%= icon %>"></i> <%= feature %>
              </button>
            <% end %>
          </div>
          <hr>
          <h3>Gearbox</h3>
          <div class="gearbox">
            <div class="checkbox-wrapper-33">
              <label class="checkbox" for="gearbox-all">
                <%= check_box_tag "gearbox[]", "All", false, class: "checkbox__trigger visuallyhidden", id: "gearbox-all", name: "gearbox_all" %>
                <span class="checkbox__symbol">
                  <svg aria-hidden="true" class="icon-checkbox" width="28px" height="28px" viewBox="0 0 28 28" version="1" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 14l8 7L24 7"></path>
                  </svg>
                </span>
                <p class="checkbox__textwrapper">All</p>
              </label>
            </div>
            <div class="checkbox-wrapper-33">
              <label class="checkbox" for="gearbox-manual">
                <%= check_box_tag "gearbox[]", "Manual gearbox", false, class: "checkbox__trigger visuallyhidden", id: "gearbox-manual", name: "gearbox_manual" %>
                <span class="checkbox__symbol">
                  <svg aria-hidden="true" class="icon-checkbox" width="28px" height="28px" viewBox="0 0 28 28" version="1" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 14l8 7L24 7"></path>
                  </svg>
                </span>
                <p class="checkbox__textwrapper">Manual gearbox</p>
              </label>
            </div>
            <div class="checkbox-wrapper-33">
              <label class="checkbox" for="gearbox-automatic">
                <%= check_box_tag "gearbox[]", "Automatic box", false, class: "checkbox__trigger visuallyhidden", id: "gearbox-automatic", name: "gearbox_automatic" %>
                <span class="checkbox__symbol">
                  <svg aria-hidden="true" class="icon-checkbox" width="28px" height="28px" viewBox="0 0 28 28" version="1" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 14l8 7L24 7"></path>
                  </svg>
                </span>
                <p class="checkbox__textwrapper">Automatic box</p>
              </label>
            </div>
          </div>
          <hr>
          <h3>Engine</h3>
          <div class="engine">
            <div class="checkbox-wrapper-33">
              <label class="checkbox" for="engine-electric">
                <%= check_box_tag "engine[]", "Electric", false, class: "checkbox__trigger visuallyhidden", id: "engine-electric", name: "engine_electric" %>
                <span class="checkbox__symbol">
                  <svg aria-hidden="true" class="icon-checkbox" width="28px" height="28px" viewBox="0 0 28 28" version="1" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 14l8 7L24 7"></path>
                  </svg>
                </span>
                <p class="checkbox__textwrapper">Electric</p>
              </label>
            </div>
            <div class="checkbox-wrapper-33">
              <label class="checkbox" for="engine-hybrid">
                <%= check_box_tag "engine[]", "Hybrid", false, class: "checkbox__trigger visuallyhidden", id: "engine-hybrid", name: "engine_hybrid" %>
                <span class="checkbox__symbol">
                  <svg aria-hidden="true" class="icon-checkbox" width="28px" height="28px" viewBox="0 0 28 28" version="1" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 14l8 7L24 7"></path>
                  </svg>
                </span>
                <p class="checkbox__textwrapper">Hybrid</p>
              </label>
            </div>
            <div class="checkbox-wrapper-33">
              <label class="checkbox" for="engine-petrol">
                <%= check_box_tag "engine[]", "Petrol", false, class: "checkbox__trigger visuallyhidden", id: "engine-petrol", name: "engine_petrol" %>
                <span class="checkbox__symbol">
                  <svg aria-hidden="true" class="icon-checkbox" width="28px" height="28px" viewBox="0 0 28 28" version="1" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 14l8 7L24 7"></path>
                  </svg>
                </span>
                <p class="checkbox__textwrapper">Petrol</p>
              </label>
            </div>
            <div class="checkbox-wrapper-33">
              <label class="checkbox" for="engine-diesel">
                <%= check_box_tag "engine[]", "Diesel", false, class: "checkbox__trigger visuallyhidden", id: "engine-diesel", name: "engine_diesel" %>
                <span class="checkbox__symbol">
                  <svg aria-hidden="true" class="icon-checkbox" width="28px" height="28px" viewBox="0 0 28 28" version="1" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 14l8 7L24 7"></path>
                  </svg>
                </span>
                <p class="checkbox__textwrapper">Diesel</p>
              </label>
            </div>
          </div>
          <hr>
          <h3>Brand</h3>
          <div class="brand">
            <% ['Renault', 'Peugeot', 'Mercedes-Benz', 'Audi', 'Alfa-Romeo', 'BMW', 'Chevrolet', 'Citroen', 'Dacia', 'Fiat', 'Ford', 'Honda', 'Hyundai', 'Kia', 'Land-Rover', 'Mazda', 'Mini', 'Mitsubishi', 'Nissan', 'Opel', 'Seat', 'Skoda', 'Smart', 'Suzuki', 'Tesla', 'Toyota', 'Volkswagen', 'Volvo'].each do |brand| %>
              <div class="checkbox-wrapper-33">
                <label class="checkbox" for="brand-<%= brand.parameterize %>">
                  <%= check_box_tag "brand[]", brand, false, class: "checkbox__trigger visuallyhidden", id: "brand-#{brand.parameterize}", name: "brand_#{brand.parameterize}" %>
                  <span class="checkbox__symbol">
                    <svg aria-hidden="true" class="icon-checkbox" width="28px" height="28px" viewBox="0 0 28 28" version="1" xmlns="http://www.w3.org/2000/svg">
                      <path d="M4 14l8 7L24 7"></path>
                    </svg>
                  </span>
                  <p class="checkbox__textwrapper"><%= brand %></p>
                </label>
              </div>
            <% end %>
          </div>
          <hr>
          <button class="apply-button" type="submit">Apply Filters</button>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="main-container">
  <div class="cars-list-container">
    <div class="cars-container">
      <%= render partial: 'cars/car_list', locals: { cars: @cars } %>
      <% if current_user %>
        <%= link_to 'Add New Car', new_car_path, class: 'add-car-button' %>
      <% end %>
    </div>
  </div>
  <div class="map-container" data-controller="map" data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>" data-map-markers-value='<%= @markers.to_json %>'>
    <div id="map"></div>
  </div>
</div>
