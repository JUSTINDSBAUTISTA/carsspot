<h1>Cars</h1>
<p><%= pluralize(@cars.count, 'car') %> found</p>

<div class="filter-container" data-controller="date-picker car dropdown modal places-autocomplete">
  <%= form_with url: cars_path, method: :get, local: true do |form| %>
    <div class="filter-row">
      <div data-controller="places-autocomplete" style="position: relative;">
        <form id="search-form" data-action="submit->places-autocomplete#search">
          <input type="text" class="search-input location-input pac-target-input" placeholder="Specific address, station, subway station..." id="searchAddress" name="location" data-places-autocomplete-target="indexInput" value="<%= params[:location] %>" autocomplete="off">
        </form>
      </div>

      <div class="datetimepicker">
        <input type="date" id="pickupDate" name="pickup_date" value="<%= params[:pickup_date] %>" data-date-picker-target="startDate">
        <span></span>
        <input type="time" id="pickupTime" name="pickup_time" value="<%= params[:pickup_time] %>" data-date-picker-target="startTime">
      </div>

      <div class="datetimepicker">
        <input type="date" id="returnDate" name="return_date" value="<%= params[:return_date] %>" data-date-picker-target="endDate">
        <span></span>
        <input type="time" id="returnTime" name="return_time" value="<%= params[:return_time] %>" data-date-picker-target="endTime">
      </div>

      <%= button_tag "Search", class: "search-button1" %>

        <%= render 'modal', form: form %>


      <div data-controller="dropdown">
        <button type="button" class="filter-button dropdown-toggle" data-action="click->dropdown#toggleDropdown" aria-haspopup="true" aria-expanded="false">Vehicle type</button>
        <div class="dropdown-menu" data-dropdown-target="dropdown">
          <h3>VEHICLE TYPE</h3>
          <div class="vehicle-types">
            <% @car_types.each do |type| %>
              <button type="button" class="vehicle-type" data-type="<%= type %>" data-action="click->dropdown#selectType click->modal#toggleButton" data-dropdown-target="vehicleTypeButton" aria-pressed="false">
                <i class="fas fa-car"></i> <%= type %>
              </button>
            <% end %>
          </div>
          <div class="dropdown-actions">
            <button type="button" class="reset-button" data-action="click->dropdown#resetFilters">Reset</button>
            <button type="button" class="apply-button" data-action="click->dropdown#applyTypes">Apply</button>
          </div>
        </div>
      </div>

      <button type="button" class="filter-button" data-action="click->modal#toggleModal">More filters</button>
    </div>
  <% end %>
</div>

<div class="main-container">
  <div class="cars-list-container">
    <div class="cars-container">
      <%= render partial: 'cars/car_list', locals: { cars: @cars } %>
      <% if current_user %>
        <%= link_to 'Add New Car', new_car_path, class: 'add-car-button' %>
      <% end %>
    </div>
  </div>
  <div class="map-container" data-controller="map" data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>" data-map-markers-value='<%= @markers.to_json %>'>
    <div id="map"></div>
  </div>
</div>
